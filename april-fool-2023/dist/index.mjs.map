{"version":3,"file":"index.mjs","sources":["../../../common/Promise.withResolvers.ts","../../../common/defineIPEPlugin.ts","../src/index.ts"],"sourcesContent":["export const promiseWithResolvers = <T extends unknown = any>() => {\n  let resolve!: (value: T | PromiseLike<T>) => void\n  let reject!: (reason?: any) => void\n  const promise = new Promise<T>((res, rej) => {\n    resolve = res\n    reject = rej\n  })\n  return { promise, resolve, reject }\n}\n\nif (!Promise.withResolvers) {\n  Promise.withResolvers = promiseWithResolvers\n}\n","import type { Inject, InPageEdit, Schema } from '@inpageedit/core'\nimport { promiseWithResolvers } from './Promise.withResolvers'\n\nexport interface IPEPlugin {\n  name: string\n  inject?: Inject\n  apply: (ctx: InPageEdit) => Promise<void> | void\n  [k: string]: any\n}\n\nexport const defineIPEPlugin = (plugin: IPEPlugin): IPEPlugin => {\n  return plugin\n}\n\nexport class BasePlugin<K extends unknown = any> {\n  public name: string\n  public config: K\n  /** 依赖注入 */\n  static inject?: Inject = []\n  /** 可重用？ */\n  static reusable = false\n  /** 插件的偏好设置模式 */\n  static PreferencesSchema?: Schema\n\n  constructor(\n    public ctx: InPageEdit,\n    config: K = undefined as unknown as K,\n    name?: string\n  ) {\n    this.name = name || ''\n    this.config = config || ({} as K)\n    const { promise, resolve, reject } = promiseWithResolvers<void>()\n    queueMicrotask(() => {\n      if (!this.name) {\n        this.name = this.constructor.name\n      }\n      try {\n        const ret = this.start()\n        if (ret && typeof (ret as Promise<unknown>).then === 'function') {\n          ;(ret as Promise<unknown>)\n            .then(() => resolve())\n            .catch((err) => {\n              this.logger.error('start() returns a rejected promise', err)\n              reject(err)\n            })\n        } else {\n          resolve()\n        }\n      } catch (err) {\n        this.logger.error('start() threw synchronously', err)\n        reject(err)\n      }\n\n      promise.then(() => {\n        this.logger.debug('started')\n      })\n      promise.catch((e) => {\n        this.logger.error('start failed', e)\n        this.ctx.scope.dispose()\n      })\n    })\n    this.ctx.once('dispose', () => {\n      this.stop()\n      this.logger.debug('disposed')\n    })\n  }\n\n  protected start(): Promise<void> | void {}\n  protected stop(): Promise<void> | void {}\n\n  get logger() {\n    return this.ctx.logger(this.name)\n  }\n  get Schema() {\n    return this.ctx.schema\n  }\n}\n","/**\n * My Little IPE 小小IPE酱\n * @author dragon-fish <xiaoyujundesu@outlook.com>\n * @license MIT\n */\n\nimport { defineIPEPlugin } from '~~/defineIPEPlugin.js'\nimport css from './style.scss?inline'\n\n// 随机对话内容\nconst RANDOM_DIALOGS: string[] = [\n  '哇哇哇，别戳我啦！',\n  '你说我头上的是什么？据说是耳朵……大概吧？',\n  '嘿~需要帮忙编辑页面吗？虽然我也不知道能帮上什么……',\n  '今天天气不错呢！咦，等等，我好像看不到窗外……',\n  '我刚才在想什么来着？算了，不重要！',\n  '有人叫我\"超级智能AI\"，其实我就是个会说话的馒头（小声）',\n  '诶，你在编辑Wiki吗？加油加油！我在旁边给你加油！',\n  '听说隔壁的插件比我聪明……不过我比较可爱，对吧？',\n  '我的梦想是成为真正有用的助手！现在嘛……还在努力中~',\n  '有时候我也搞不清楚自己在说什么，但没关系，氛围到位就行！',\n  '蹲在这个角落里看你工作，感觉自己像个吉祥物~',\n  '刚才有只虫子飞过去了！哦不对，是鼠标指针……',\n  '据说熟练使用快捷键会很厉害！我是听别人说的。',\n  '偷偷告诉你，我其实不太懂什么是机器学习……但听起来很厉害对吧！',\n  '嘿嘿，我就静静地待在这里，不给你添乱~',\n  '要不要休息一下？盯着屏幕太久对眼睛不好哦！',\n  '我想学着帮你做点什么，但好像除了卖萌也做不了别的……',\n  '每次看到你敲键盘的样子就觉得好厉害啊！',\n  '咦，那个按钮是干什么用的？算了，还是别乱碰……',\n  '我会一直陪着你的！虽然帮不上什么大忙就是了。',\n  '有BUG的话不是我的问题哦！大概……也许……可能吧？',\n  '作为一个\"AI助手\"，我决定今天就静静待着不捣乱！',\n  '听说你们人类很喜欢猫猫，所以我长了对猫耳！机智吧~',\n  '加油干活！然后早点下班去吃好吃的！',\n  '我在角落里给你念波心灵鸡汤：你是最棒的！（虽然我也不知道有没有用）',\n]\n\n// 工具函数\nconst sleep = (duration = 0): Promise<void> =>\n  new Promise((resolve) => setTimeout(resolve, duration))\n\nconst pick = <T>(arr: T[]): T => arr[Math.floor(Math.random() * arr.length)]\n\nconst randomNum = (min = 0, max = 0): number =>\n  Math.floor(Math.random() * (max - min + 1) + min)\n\n// 动画工具函数\nconst fadeIn = async (\n  element: HTMLElement,\n  duration = 240,\n  easing = 'ease-in-out'\n): Promise<void> => {\n  return new Promise((resolve) => {\n    element.style.display = ''\n    element.style.opacity = '0'\n    element.style.pointerEvents = ''\n    const anim = element.animate([{ opacity: 0 }, { opacity: 1 }], {\n      duration,\n      easing,\n    })\n    anim.addEventListener('finish', () => {\n      element.style.opacity = '1'\n      resolve()\n    })\n  })\n}\n\nconst fadeOut = (\n  element: HTMLElement,\n  duration = 240,\n  easing = 'ease-in-out'\n): Promise<void> => {\n  return new Promise((resolve) => {\n    element.style.display = ''\n    element.style.opacity = '1'\n    element.style.pointerEvents = 'none'\n    const anim = element.animate([{ opacity: 1 }, { opacity: 0 }], {\n      duration,\n      easing,\n    })\n    anim.addEventListener('finish', () => {\n      element.style.opacity = '0'\n      element.style.display = 'none'\n      resolve()\n    })\n  })\n}\n\ninterface LittlePetConfig {\n  name: string\n  chatInterval?: [number, number]\n}\n\ninterface DialogOptions {\n  content: string | string[]\n  duration?: number\n  raw?: boolean\n}\n\ninterface AddDialogOptions {\n  type?: 'random' | 'event'\n  target?: string | HTMLElement | NodeListOf<HTMLElement> | HTMLElement[]\n  event?: string\n  content: string | string[]\n  duration?: number\n  raw?: boolean\n}\n\nclass LittlePet {\n  private dialogList: string[] = []\n  private dialogEndTime = 0\n  private role: HTMLElement\n  private configs: LittlePetConfig\n  private dialogElement: HTMLElement\n  private bodyElement: HTMLElement\n  private randomTalkTimer: number | null = null\n  private cleanupTimer: number | null = null\n  private mouseMoveHandler: ((e: MouseEvent | TouchEvent) => void) | null = null\n  private dragging = false\n  private dragDeltaX = 0\n  private dragDeltaY = 0\n  private lastCenterX = 0\n  private lastCenterY = 0\n  private readonly storageKey = 'april-fool-2023:position'\n  private dragMoved = false\n  private startPointerX = 0\n  private startPointerY = 0\n  private suppressNextClick = false\n  private eventListeners: Array<{\n    element: HTMLElement | Document\n    event: string\n    handler: EventListener\n  }> = []\n  private transitionChain: Promise<void> = Promise.resolve()\n  private isDialogHiding = false\n  private hoverDelegates: Array<{\n    selector: string\n    lastTarget: HTMLElement | null\n    trigger: () => void\n  }> = []\n\n  constructor(configs: LittlePetConfig) {\n    this.configs = configs\n    this.role = this.createRole()\n    document.body.appendChild(this.role)\n\n    this.dialogElement = this.role.querySelector('pet-dialog')!\n    this.bodyElement = this.role.querySelector('pet-body')!\n\n    this.setupStyle()\n    this.bindDynamicEffects()\n    this.setupDialogCleanup()\n    this.setupRandomTalk()\n    this.setupClickHandler()\n    this.setupDragAndPosition()\n  }\n\n  private setupStyle(): void {\n    const style = document.createElement('style')\n    style.textContent = css\n    style.dataset.littlePet = 'true'\n    this.role.appendChild(style)\n  }\n\n  private createRole(): HTMLElement {\n    const pet = document.createElement('pet')\n    const entity = document.createElement('pet-entity')\n    const body = document.createElement('pet-body')\n    const ears = document.createElement('pet-ears')\n    const earLeft = document.createElement('pet-ear')\n    earLeft.setAttribute('left', '')\n    const earRight = document.createElement('pet-ear')\n    earRight.setAttribute('right', '')\n    ears.appendChild(earLeft)\n    ears.appendChild(earRight)\n\n    const eyes = document.createElement('pet-eyes')\n    const eyeLeft = document.createElement('pet-eye')\n    eyeLeft.setAttribute('left', '')\n    const eyeRight = document.createElement('pet-eye')\n    eyeRight.setAttribute('right', '')\n    eyes.appendChild(eyeLeft)\n    eyes.appendChild(eyeRight)\n\n    const mouth = document.createElement('pet-mouth')\n    const dialog = document.createElement('pet-dialog')\n    dialog.style.display = 'none'\n\n    // 新增：阴影节点，放入实体容器中，作为 body 的兄弟，位于底层\n    const shadow = document.createElement('pet-shadow')\n\n    // 实体容器：承载耳朵、身体与阴影，并承担呼吸动画\n    body.appendChild(eyes)\n    body.appendChild(mouth)\n    entity.appendChild(body)\n    entity.appendChild(ears)\n    entity.appendChild(shadow)\n\n    // 根元素装配：实体容器 + 对话框\n    pet.appendChild(entity)\n    pet.appendChild(dialog)\n\n    return pet\n  }\n\n  private bindDynamicEffects(): void {\n    const ears = this.role.querySelector('pet-ears') as HTMLElement\n    const eyes = this.role.querySelector('pet-eyes') as HTMLElement\n    const mouth = this.role.querySelector('pet-mouth') as HTMLElement\n    const dialog = this.dialogElement\n\n    const handler = (event: MouseEvent | TouchEvent) => {\n      const clientX =\n        event instanceof MouseEvent ? event.clientX : event.touches[0].clientX\n      const clientY =\n        event instanceof MouseEvent ? event.clientY : event.touches[0].clientY\n\n      const eyesRect = eyes.getBoundingClientRect()\n      const x = -(eyesRect.left - clientX)\n      const y = -(eyesRect.top - clientY)\n\n      ears.style.transform = `translateY(${y / -300}px) translateX(${\n        x / -220\n      }px)`\n      eyes.style.transform = `translateY(${y / 120}px) translateX(${x / 120}px)`\n      mouth.style.transform = `translateY(${y / 300}px) translateX(${\n        x / 200\n      }px)`\n      // 口部需要保留基础的水平居中偏移（CSS 中有 translateX(-50%)）\n      mouth.style.transform = `translateX(-50%) translateY(${\n        y / 300\n      }px) translateX(${x / 200}px)`\n      dialog.style.transform = `translateY(${y / -160}px) translateX(${\n        x / -100\n      }px)`\n\n      // 统一 mousemove 委托触发 mouseenter（基于选择器）\n      if (this.hoverDelegates.length) {\n        const pointEl = document.elementFromPoint(\n          clientX,\n          clientY\n        ) as HTMLElement | null\n        for (const d of this.hoverDelegates) {\n          const matched = pointEl\n            ? (pointEl.closest(d.selector) as HTMLElement | null)\n            : null\n          if (matched !== d.lastTarget) {\n            d.lastTarget = matched\n            if (matched) {\n              d.trigger()\n            }\n          }\n        }\n      }\n    }\n\n    this.mouseMoveHandler = handler\n    document.addEventListener('mousemove', handler)\n    document.addEventListener('touchmove', handler)\n  }\n\n  private setupDialogCleanup(): void {\n    const clickToHide = () => {\n      this.dialogEndTime = Date.now()\n    }\n    this.dialogElement.addEventListener('click', clickToHide)\n    this.eventListeners.push({\n      element: this.dialogElement,\n      event: 'click',\n      handler: clickToHide,\n    })\n\n    // 定时清理对话框\n    this.cleanupTimer = window.setInterval(() => {\n      const now = Date.now()\n      if (\n        now > this.dialogEndTime &&\n        !this.isDialogHiding &&\n        this.dialogElement.style.display !== 'none'\n      ) {\n        this.isDialogHiding = true\n        fadeOut(this.dialogElement, 240).finally(() => {\n          this.isDialogHiding = false\n        })\n      }\n    }, 50)\n  }\n\n  private setupRandomTalk(): void {\n    const randomTalk = async () => {\n      if (Date.now() >= this.dialogEndTime) {\n        await this.say({\n          content: pick(this.dialogList),\n        })\n      }\n      await sleep(randomNum(15 * 1000, 25 * 1000))\n      if (this.randomTalkTimer !== null) {\n        randomTalk()\n      }\n    }\n\n    this.randomTalkTimer = 1 // 标记为活跃\n    randomTalk()\n  }\n\n  private setupClickHandler(): void {\n    const clickHandler = () => {\n      // 若刚结束拖拽，则抑制一次点击对话\n      if (this.suppressNextClick) {\n        this.suppressNextClick = false\n        return\n      }\n      // 宠物点击允许随时打断当前对话\n      this.say({\n        content: pick(this.dialogList),\n      })\n    }\n    this.bodyElement.addEventListener('click', clickHandler)\n    this.eventListeners.push({\n      element: this.bodyElement,\n      event: 'click',\n      handler: clickHandler,\n    })\n  }\n\n  private setupDragAndPosition(): void {\n    // 初始应用已保存位置，或根据当前默认位置更新对话框朝向\n    this.applySavedPosition()\n    this.updateDialogSideByCenter()\n    // 拖拽（鼠标）\n    const onMouseDown = (e: MouseEvent) => {\n      // 仅主键\n      if (e.button !== 0) return\n      this.startDrag(e.clientX, e.clientY)\n      e.preventDefault()\n    }\n    const onMouseMove = (e: MouseEvent) => {\n      if (!this.dragging) return\n      this.onDrag(e.clientX, e.clientY)\n      e.preventDefault()\n    }\n    const onMouseUp = () => {\n      if (!this.dragging) return\n      this.endDrag()\n    }\n    this.bodyElement.addEventListener('mousedown', onMouseDown)\n    document.addEventListener('mousemove', onMouseMove)\n    document.addEventListener('mouseup', onMouseUp)\n    this.eventListeners.push(\n      {\n        element: this.bodyElement,\n        event: 'mousedown',\n        handler: onMouseDown as unknown as EventListener,\n      },\n      {\n        element: document,\n        event: 'mousemove',\n        handler: onMouseMove as unknown as EventListener,\n      },\n      {\n        element: document,\n        event: 'mouseup',\n        handler: onMouseUp as unknown as EventListener,\n      }\n    )\n\n    // 拖拽（触摸）\n    let activeTouchId: number | null = null\n    const onTouchStart = (e: TouchEvent) => {\n      if (activeTouchId !== null) return\n      const t = e.changedTouches[0]\n      activeTouchId = t.identifier\n      this.startDrag(t.clientX, t.clientY)\n      // 若页面有滚动手势，依赖 CSS touch-action: none\n    }\n    const onTouchMove = (e: TouchEvent) => {\n      if (!this.dragging || activeTouchId === null) return\n      for (const t of Array.from(e.changedTouches)) {\n        if (t.identifier === activeTouchId) {\n          this.onDrag(t.clientX, t.clientY)\n          break\n        }\n      }\n    }\n    const endTouchCommon = (e: TouchEvent) => {\n      if (activeTouchId === null) return\n      for (const t of Array.from(e.changedTouches)) {\n        if (t.identifier === activeTouchId) {\n          activeTouchId = null\n          if (this.dragging) this.endDrag()\n          break\n        }\n      }\n    }\n    this.bodyElement.addEventListener('touchstart', onTouchStart, {\n      passive: true,\n    })\n    document.addEventListener('touchmove', onTouchMove, { passive: true })\n    document.addEventListener('touchend', endTouchCommon, { passive: true })\n    document.addEventListener('touchcancel', endTouchCommon, { passive: true })\n    this.eventListeners.push(\n      {\n        element: this.bodyElement,\n        event: 'touchstart',\n        handler: onTouchStart as EventListener,\n      },\n      {\n        element: document,\n        event: 'touchmove',\n        handler: onTouchMove as EventListener,\n      },\n      {\n        element: document,\n        event: 'touchend',\n        handler: endTouchCommon as EventListener,\n      },\n      {\n        element: document,\n        event: 'touchcancel',\n        handler: endTouchCommon as EventListener,\n      }\n    )\n\n    // 窗口尺寸变化时按保存的相对位置重算\n    const onResize = () => {\n      this.applySavedPosition()\n      this.updateDialogSideByCenter()\n    }\n    window.addEventListener('resize', onResize)\n    this.eventListeners.push({\n      element: window as unknown as Document,\n      event: 'resize',\n      handler: onResize as unknown as EventListener,\n    })\n  }\n\n  private startDrag(pointerX: number, pointerY: number): void {\n    const bodyRect = this.bodyElement.getBoundingClientRect()\n    const centerX = bodyRect.left + bodyRect.width / 2\n    const centerY = bodyRect.top + bodyRect.height / 2\n    this.dragDeltaX = centerX - pointerX\n    this.dragDeltaY = centerY - pointerY\n    this.startPointerX = pointerX\n    this.startPointerY = pointerY\n    this.dragMoved = false\n    this.dragging = true\n  }\n\n  private onDrag(pointerX: number, pointerY: number): void {\n    // 判定是否发生明显拖动（阈值约 3px）\n    if (!this.dragMoved) {\n      const dx = pointerX - this.startPointerX\n      const dy = pointerY - this.startPointerY\n      if (dx * dx + dy * dy > 9) {\n        this.dragMoved = true\n      }\n    }\n    const centerX = pointerX + this.dragDeltaX\n    const centerY = pointerY + this.dragDeltaY\n    this.updatePosition(centerX, centerY, false)\n  }\n\n  private endDrag(): void {\n    this.dragging = false\n    // 若发生拖拽，则抑制下一次 click\n    if (this.dragMoved) {\n      this.suppressNextClick = true\n    }\n    // 保存最终位置（相对、以中心点为准，按象限记录）\n    this.savePositionByCenter(this.lastCenterX, this.lastCenterY)\n  }\n\n  private clampCenter(\n    centerX: number,\n    centerY: number\n  ): { x: number; y: number } {\n    const vw = window.innerWidth\n    const vh = window.innerHeight\n    const bodyRect = this.bodyElement.getBoundingClientRect()\n    const halfW = bodyRect.width / 2\n    const halfH = bodyRect.height / 2\n    const x = Math.min(Math.max(centerX, halfW), vw - halfW)\n    const y = Math.min(Math.max(centerY, halfH), vh - halfH)\n    return { x, y }\n  }\n\n  private updatePosition(centerX: number, centerY: number, save = false): void {\n    const { x, y } = this.clampCenter(centerX, centerY)\n    const bodyRect = this.bodyElement.getBoundingClientRect()\n    const left = Math.round(x - bodyRect.width / 2)\n    const top = Math.round(y - bodyRect.height / 2)\n    // 采用 left/top，清空 right/bottom\n    const roleStyle = this.role.style\n    roleStyle.left = `${left}px`\n    roleStyle.top = `${top}px`\n    roleStyle.right = ''\n    roleStyle.bottom = ''\n    this.lastCenterX = x\n    this.lastCenterY = y\n    this.updateDialogSideByCenter()\n    if (save) {\n      this.savePositionByCenter(x, y)\n    }\n  }\n\n  private updateDialogSideByCenter(): void {\n    const vw = window.innerWidth\n    const centerX = this.getCurrentCenterX()\n    // 位于中轴线左侧 => 对话框在右侧；反之亦然\n    const side = centerX <= vw / 2 ? 'right' : 'left'\n    this.role.setAttribute('dialog-side', side)\n  }\n\n  private getCurrentCenterX(): number {\n    if (this.lastCenterX) return this.lastCenterX\n    const bodyRect = this.bodyElement.getBoundingClientRect()\n    return bodyRect.left + bodyRect.width / 2\n  }\n\n  private savePositionByCenter(centerX: number, centerY: number): void {\n    const vw = window.innerWidth\n    const vh = window.innerHeight\n    const h = centerX <= vw / 2 ? 'left' : 'right'\n    const v = centerY <= vh / 2 ? 'top' : 'bottom'\n    const xRel = h === 'left' ? centerX / vw : (vw - centerX) / vw\n    const yRel = v === 'top' ? centerY / vh : (vh - centerY) / vh\n    const payload = { h, v, xRel, yRel, t: Date.now() }\n    try {\n      localStorage.setItem(this.storageKey, JSON.stringify(payload))\n    } catch {}\n  }\n\n  private loadSaved(): {\n    h: 'left' | 'right'\n    v: 'top' | 'bottom'\n    xRel: number\n    yRel: number\n  } | null {\n    try {\n      const raw = localStorage.getItem(this.storageKey)\n      if (!raw) return null\n      const data = JSON.parse(raw)\n      if (!data || typeof data !== 'object') return null\n      const { h, v, xRel, yRel } = data as {\n        h: 'left' | 'right'\n        v: 'top' | 'bottom'\n        xRel: number\n        yRel: number\n      }\n      if (!h || !v || typeof xRel !== 'number' || typeof yRel !== 'number')\n        return null\n      return { h, v, xRel, yRel }\n    } catch {\n      return null\n    }\n  }\n\n  private applySavedPosition(): void {\n    const saved = this.loadSaved()\n    if (!saved) {\n      // 没有保存的相对位置，使用 CSS 默认定位，但补充记录 center\n      const bodyRect = this.bodyElement.getBoundingClientRect()\n      this.lastCenterX = bodyRect.left + bodyRect.width / 2\n      this.lastCenterY = bodyRect.top + bodyRect.height / 2\n      return\n    }\n    const vw = window.innerWidth\n    const vh = window.innerHeight\n    const centerX = saved.h === 'left' ? vw * saved.xRel : vw - vw * saved.xRel\n    const centerY = saved.v === 'top' ? vh * saved.yRel : vh - vh * saved.yRel\n    this.updatePosition(centerX, centerY, false)\n  }\n\n  async say({\n    content = '',\n    duration = 5000,\n    raw = false,\n  }: DialogOptions): Promise<this> {\n    if (!content) return this\n\n    // 如果 content 是数组，随机选一个\n    const finalContent = Array.isArray(content) ? pick(content) : content\n    if (!finalContent) return this\n\n    // 串行化过渡动画与 DOM 写入，避免并发条件竞争\n    await (this.transitionChain = this.transitionChain.then(async () => {\n      const now = Date.now()\n      const dialog = this.dialogElement\n      const endTimeOriginal = this.dialogEndTime\n      this.dialogEndTime = now + duration\n\n      if (now <= endTimeOriginal + 240) {\n        await fadeOut(dialog, 120)\n        await sleep(120)\n      }\n\n      const nameDiv = document.createElement('div')\n      nameDiv.style.fontWeight = '700'\n      nameDiv.textContent = this.configs.name + ': '\n\n      dialog.innerHTML = ''\n      dialog.appendChild(nameDiv)\n\n      if (raw) {\n        const contentDiv = document.createElement('div')\n        contentDiv.innerHTML = finalContent\n        dialog.appendChild(contentDiv)\n      } else {\n        const contentDiv = document.createElement('div')\n        contentDiv.textContent = finalContent\n        dialog.appendChild(contentDiv)\n      }\n\n      await fadeIn(dialog, 240)\n    }))\n\n    // 不阻塞后续 say 的过渡，仅保持返回 Promise 在可见时长后完成\n    await sleep(duration)\n    return this\n  }\n\n  addDialog({\n    type = 'random',\n    target,\n    event = 'click',\n    content = '',\n    duration = 5000,\n    raw = false,\n  }: AddDialogOptions): this {\n    if (!content) return this\n\n    if (type === 'random') {\n      // 如果 content 是数组，展开后逐个添加\n      if (Array.isArray(content)) {\n        this.dialogList.push(...content)\n      } else {\n        this.dialogList.push(content)\n      }\n      return this\n    }\n\n    // 统一用 mousemove 代理 mouseenter（仅字符串选择器支持）\n    if (\n      type === 'event' &&\n      event === 'mouseenter' &&\n      typeof target === 'string'\n    ) {\n      const trigger = () => {\n        this.say({ content, duration, raw })\n      }\n      this.hoverDelegates.push({\n        selector: target,\n        lastTarget: null,\n        trigger: () => {\n          // 对话未结束时，不触发 hover 对话\n          if (Date.now() < this.dialogEndTime) return\n          trigger()\n        },\n      })\n      return this\n    }\n\n    let elements: HTMLElement[] = []\n\n    if (typeof target === 'string') {\n      const result = document.querySelectorAll<HTMLElement>(target)\n      elements = Array.from(result)\n    } else if (target instanceof HTMLElement) {\n      elements = [target]\n    } else if (target instanceof NodeList || Array.isArray(target)) {\n      elements = Array.from(target as HTMLElement[])\n    }\n\n    if (elements.length === 0) return this\n\n    // event 类型的 content 可以是数组，触发时随机选一个\n    const handler = () => {\n      // 对话未结束时，不触发除宠物点击外的事件对话\n      if (Date.now() < this.dialogEndTime) return\n      this.say({ content, duration, raw })\n    }\n\n    for (const element of elements) {\n      element.addEventListener(event, handler)\n      this.eventListeners.push({\n        element,\n        event,\n        handler,\n      })\n    }\n\n    return this\n  }\n\n  async dispose(): Promise<void> {\n    // 停止随机对话\n    this.randomTalkTimer = null\n\n    // 清理定时器\n    if (this.cleanupTimer !== null) {\n      clearInterval(this.cleanupTimer)\n    }\n\n    // 清理事件监听器\n    if (this.mouseMoveHandler) {\n      document.removeEventListener('mousemove', this.mouseMoveHandler)\n      document.removeEventListener('touchmove', this.mouseMoveHandler)\n    }\n\n    for (const { element, event, handler } of this.eventListeners) {\n      element.removeEventListener(event, handler)\n    }\n    this.eventListeners = []\n    this.hoverDelegates = []\n\n    // 显示告别消息并移除元素\n    await this.say({\n      content: '那我先溜啦~下次再来陪你！拜拜~',\n      duration: 1500,\n    })\n    await fadeOut(this.role, 120)\n    await sleep(120)\n    this.role.remove()\n  }\n}\n\nexport default defineIPEPlugin({\n  name: 'april-fool-2023',\n  apply: (ctx) => {\n    const chan = new LittlePet({\n      name: 'Little IPE',\n      chatInterval: [15 * 1000, 30 * 1000],\n    })\n\n    // 开场白\n    chan\n      .say({\n        content:\n          '嗨呀~我是【<b style=\"display:inline;font-weight:700;font-size:1.2em\">IPE酱</b>】！一只会说话的……咳咳，我是说，一个超级智能的 AI 助手！（虽然实际上就是蹲在角落里卖萌）总之，希望能陪你一起编辑 Wiki，加油鸭~',\n        duration: 8000,\n        raw: true,\n      })\n      .then(() => {\n        if (Date.now() >= chan['dialogEndTime']) {\n          chan.say({\n            content: '（对了）双击我说的话可以让对话框消失哦~',\n          })\n        }\n      })\n\n    // 随机对话\n    for (const content of RANDOM_DIALOGS) {\n      chan.addDialog({ type: 'random', content })\n    }\n\n    // 特殊触发器\n    chan.addDialog({\n      type: 'event',\n      target: '#ipe-toolbox__quick-edit, a[href*=\"action=edit\"]',\n      event: 'mouseenter',\n      content: [\n        '要编辑页面吗？emmm……其实我帮不上什么忙，但我可以在旁边默默给你打气！<b style=\"display:inline;font-weight:700;font-size:1.2em\">加油加油~</b>',\n        '编辑按钮诶！虽然我不会编辑，但我会给你精神支持！',\n        '准备大展身手了吗？我就在这里看着你哦~',\n        '要改页面啦？我……我就在角落里默默支持你！',\n      ],\n      duration: 5000,\n      raw: true,\n    })\n\n    chan.addDialog({\n      type: 'event',\n      target: '#ipe-toolbox__quick-delete, a[href*=\"action=delete\"]',\n      event: 'mouseenter',\n      content: [\n        '咦？删除按钮诶……要三思而后行哦！（虽然我也不知道该怎么三思）',\n        '删除？！这个操作好像很危险的样子……',\n        '等等！你确定要删吗？我有点紧张……',\n        '这是删除按钮吗？要小心哦！删了就找不回来了！大概！',\n      ],\n    })\n\n    chan.addDialog({\n      type: 'event',\n      target: '#ipe-toolbox__preferences',\n      event: 'mouseenter',\n      content: [\n        '这个是设置按钮！但不管你怎么设置，我都会在这里陪你的~',\n        '设置？会不会把我也设置没了……应该不会吧？',\n        '看起来是个很重要的按钮呢！',\n        '调整设置可以让编辑更方便哦！我猜的~',\n      ],\n    })\n\n    chan.addDialog({\n      type: 'event',\n      target: 'a.image',\n      event: 'mouseenter',\n      content: [\n        '哇！图片诶！看起来好厉害的样子！',\n        '这张图片好好看！是你上传的吗？',\n        '图图！让我也康康！',\n        '诶嘿，发现了一张有趣的图片~',\n      ],\n    })\n\n    // 插件卸载时清理\n    ctx.on('dispose', () => {\n      chan.dispose()\n    })\n  },\n})\n"],"names":["promiseWithResolvers","resolve","reject","res","rej","defineIPEPlugin","plugin","RANDOM_DIALOGS","sleep","duration","pick","arr","randomNum","min","max","fadeIn","element","easing","fadeOut","LittlePet","configs","style","css","pet","entity","body","ears","earLeft","earRight","eyes","eyeLeft","eyeRight","mouth","dialog","shadow","handler","event","clientX","clientY","eyesRect","x","y","pointEl","d","matched","clickToHide","randomTalk","clickHandler","onMouseDown","e","onMouseMove","onMouseUp","activeTouchId","onTouchStart","t","onTouchMove","endTouchCommon","onResize","pointerX","pointerY","bodyRect","centerX","centerY","dx","dy","vw","vh","halfW","halfH","save","left","top","roleStyle","side","h","v","xRel","yRel","payload","raw","data","saved","content","finalContent","now","endTimeOriginal","nameDiv","contentDiv","type","target","trigger","elements","result","index","ctx","chan"],"mappings":"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"}