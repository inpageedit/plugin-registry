{"version":3,"file":"index.mjs","sources":["../../../node_modules/.pnpm/jsx-dom@8.1.6/node_modules/jsx-dom/index.js","../../../common/Promise.withResolvers.ts","../../../common/defineIPEPlugin.ts","../src/index.tsx"],"sourcesContent":["/* eslint-disable */\nconst keys = Object.keys;\nfunction identity(value) {\n  return value;\n}\nfunction isBoolean(val) {\n  return typeof val === \"boolean\";\n}\nfunction isElement(val) {\n  return val && typeof val.nodeType === \"number\";\n}\nfunction isString(val) {\n  return typeof val === \"string\";\n}\nfunction isNumber(val) {\n  return typeof val === \"number\";\n}\nfunction isObject(val) {\n  return typeof val === \"object\" ? val !== null : isFunction(val);\n}\nfunction isFunction(val) {\n  return typeof val === \"function\";\n}\nfunction isComponentClass(Component) {\n  return !!(Component && Component.isComponent);\n}\nfunction isArrayLike(obj) {\n  return (\n    isObject(obj) &&\n    typeof obj.length === \"number\" &&\n    typeof obj.nodeType !== \"number\"\n  );\n}\nfunction forEach(value, fn) {\n  if (!value) return;\n  for (const key of keys(value)) {\n    fn(value[key], key);\n  }\n}\n\nfunction createRef() {\n  return Object.seal({\n    current: null,\n  });\n}\nfunction isRef(maybeRef) {\n  return isObject(maybeRef) && \"current\" in maybeRef;\n}\n\n/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found on\n * https://github.com/facebook/react/blob/b87aabdfe1b7461e7331abb3601d9e6bb27544bc/LICENSE\n */\n\n/**\n * CSS properties which accept numbers but are not in units of \"px\".\n */\nconst isUnitlessNumber = {\n  animationIterationCount: 0,\n  borderImageOutset: 0,\n  borderImageSlice: 0,\n  borderImageWidth: 0,\n  boxFlex: 0,\n  boxFlexGroup: 0,\n  boxOrdinalGroup: 0,\n  columnCount: 0,\n  columns: 0,\n  flex: 0,\n  flexGrow: 0,\n  flexPositive: 0,\n  flexShrink: 0,\n  flexNegative: 0,\n  flexOrder: 0,\n  gridArea: 0,\n  gridRow: 0,\n  gridRowEnd: 0,\n  gridRowSpan: 0,\n  gridRowStart: 0,\n  gridColumn: 0,\n  gridColumnEnd: 0,\n  gridColumnSpan: 0,\n  gridColumnStart: 0,\n  fontWeight: 0,\n  lineClamp: 0,\n  lineHeight: 0,\n  opacity: 0,\n  order: 0,\n  orphans: 0,\n  tabSize: 0,\n  widows: 0,\n  zIndex: 0,\n  zoom: 0,\n  // SVG-related properties\n  fillOpacity: 0,\n  floodOpacity: 0,\n  stopOpacity: 0,\n  strokeDasharray: 0,\n  strokeDashoffset: 0,\n  strokeMiterlimit: 0,\n  strokeOpacity: 0,\n  strokeWidth: 0,\n};\n\n/**\n * @param prefix vendor-specific prefix, eg: Webkit\n * @param key style name, eg: transitionDuration\n * @return style name prefixed with `prefix`, properly camelCased, eg:\n * WebkitTransitionDuration\n */\nfunction prefixKey(prefix, key) {\n  return prefix + key.charAt(0).toUpperCase() + key.substring(1);\n}\n\n/**\n * Support style names that may come passed in prefixed by adding permutations\n * of vendor prefixes.\n */\nconst prefixes = [\"Webkit\", \"ms\", \"Moz\", \"O\"];\n// Using Object.keys here, or else the vanilla for-in loop makes IE8 go into an\n// infinite loop, because it iterates over the newly added props too.\nkeys(isUnitlessNumber).forEach((prop) => {\n  prefixes.forEach((prefix) => {\n    isUnitlessNumber[prefixKey(prefix, prop)] = 0; // isUnitlessNumber[prop]\n  });\n});\n\nconst jsxDomType = Symbol.for(\"jsx-dom:type\");\nvar JsxDomType = /*#__PURE__*/ (function (JsxDomType) {\n  JsxDomType[\"ShadowRoot\"] = \"ShadowRoot\";\n  return JsxDomType;\n})(JsxDomType || {});\nfunction ShadowRoot(_ref) {\n  let { children, ref, ...attr } = _ref;\n  return {\n    [jsxDomType]: JsxDomType.ShadowRoot,\n    ref,\n    attr,\n    children,\n  };\n}\nfunction isShadowRoot(el) {\n  return el != null && el[jsxDomType] === JsxDomType.ShadowRoot;\n}\n\nconst SVGNamespace = \"http://www.w3.org/2000/svg\";\nconst XLinkNamespace = \"http://www.w3.org/1999/xlink\";\nconst XMLNamespace = \"http://www.w3.org/XML/1998/namespace\";\n\n// https://facebook.github.io/react/docs/jsx-in-depth.html#booleans-null-and-undefined-are-ignored\n// Emulate JSX Expression logic to ignore certain type of children or className.\nfunction isVisibleChild(value) {\n  return !isBoolean(value) && value != null;\n}\n\n/**\n * Convert a `value` to a className string.\n * `value` can be a string, an array or a `Dictionary<boolean>`.\n */\nfunction className(value) {\n  if (Array.isArray(value)) {\n    return value.map(className).filter(Boolean).join(\" \");\n  } else if (isObject(value)) {\n    if (Symbol.iterator in value) {\n      return className(Array.from(value));\n    }\n    return keys(value)\n      .filter((k) => value[k])\n      .join(\" \");\n  } else if (isVisibleChild(value)) {\n    return \"\" + value;\n  } else {\n    return \"\";\n  }\n}\nconst svg = {\n  animate: 0,\n  circle: 0,\n  clipPath: 0,\n  defs: 0,\n  desc: 0,\n  ellipse: 0,\n  feBlend: 0,\n  feColorMatrix: 0,\n  feComponentTransfer: 0,\n  feComposite: 0,\n  feConvolveMatrix: 0,\n  feDiffuseLighting: 0,\n  feDisplacementMap: 0,\n  feDistantLight: 0,\n  feFlood: 0,\n  feFuncA: 0,\n  feFuncB: 0,\n  feFuncG: 0,\n  feFuncR: 0,\n  feGaussianBlur: 0,\n  feImage: 0,\n  feMerge: 0,\n  feMergeNode: 0,\n  feMorphology: 0,\n  feOffset: 0,\n  fePointLight: 0,\n  feSpecularLighting: 0,\n  feSpotLight: 0,\n  feTile: 0,\n  feTurbulence: 0,\n  filter: 0,\n  foreignObject: 0,\n  g: 0,\n  image: 0,\n  line: 0,\n  linearGradient: 0,\n  marker: 0,\n  mask: 0,\n  metadata: 0,\n  path: 0,\n  pattern: 0,\n  polygon: 0,\n  polyline: 0,\n  radialGradient: 0,\n  rect: 0,\n  stop: 0,\n  svg: 0,\n  switch: 0,\n  symbol: 0,\n  text: 0,\n  textPath: 0,\n  tspan: 0,\n  use: 0,\n  view: 0,\n};\nconst nonPresentationSVGAttributes =\n  /^(a(ll|t|u)|base[FP]|c(al|lipPathU|on)|di|ed|ex|filter[RU]|g(lyphR|r)|ke|l(en|im)|ma(rker[HUW]|s)|n|pat|pr|point[^e]|re[^n]|s[puy]|st[^or]|ta|textL|vi|xC|y|z)/;\nfunction createFactory(tag) {\n  return createElement.bind(null, tag);\n}\nfunction Fragment(attr) {\n  const fragment = document.createDocumentFragment();\n  appendChild(attr.children, fragment);\n  return fragment;\n}\nclass Component {\n  static isComponent = true;\n  constructor(props) {\n    this.props = props;\n  }\n  render() {\n    return null;\n  }\n}\nfunction initComponentClass(Class, attr, children) {\n  attr = {\n    ...attr,\n    children,\n  };\n  const instance = new Class(attr);\n  const node = instance.render();\n  if (\"ref\" in attr) {\n    attachRef(attr.ref, instance);\n  }\n  return node;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction jsx(tag, _ref) {\n  let { children, ...attr } = _ref;\n  if (!attr.namespaceURI && svg[tag] === 0) {\n    attr = {\n      ...attr,\n      namespaceURI: SVGNamespace,\n    };\n  }\n  let node;\n  if (isString(tag)) {\n    node = attr.namespaceURI\n      ? document.createElementNS(attr.namespaceURI, tag)\n      : document.createElement(tag);\n    attributes(attr, node);\n    appendChild(children, node);\n\n    // Select `option` elements in `select`\n    if (node instanceof window.HTMLSelectElement && attr.value != null) {\n      if (attr.multiple === true && Array.isArray(attr.value)) {\n        const values = attr.value.map((value) => String(value));\n        node\n          .querySelectorAll(\"option\")\n          .forEach(\n            (option) => (option.selected = values.includes(option.value)),\n          );\n      } else {\n        node.value = attr.value;\n      }\n    }\n    attachRef(attr.ref, node);\n  } else if (isFunction(tag)) {\n    // Custom elements.\n    if (isObject(tag.defaultProps)) {\n      attr = {\n        ...tag.defaultProps,\n        ...attr,\n      };\n    }\n    node = isComponentClass(tag)\n      ? initComponentClass(tag, attr, children)\n      : tag({\n          ...attr,\n          children,\n        });\n  } else {\n    throw new TypeError(`Invalid JSX element type: ${tag}`);\n  }\n  return node;\n}\nfunction createElement(tag, attr) {\n  for (\n    var _len = arguments.length,\n      children = new Array(_len > 2 ? _len - 2 : 0),\n      _key2 = 2;\n    _key2 < _len;\n    _key2++\n  ) {\n    children[_key2 - 2] = arguments[_key2];\n  }\n  if (isString(attr) || Array.isArray(attr)) {\n    children.unshift(attr);\n    attr = {};\n  }\n  attr = attr || {};\n  if (attr.children != null && !children.length) {\n    ({ children, ...attr } = attr);\n  }\n  return jsx(\n    tag,\n    {\n      ...attr,\n      children,\n    },\n    attr.key,\n  );\n}\nfunction attachRef(ref, node) {\n  if (isRef(ref)) {\n    ref.current = node;\n  } else if (isFunction(ref)) {\n    ref(node);\n  }\n}\nfunction appendChild(child, node) {\n  if (isArrayLike(child)) {\n    appendChildren(child, node);\n  } else if (isString(child) || isNumber(child)) {\n    appendChildToNode(document.createTextNode(child), node);\n  } else if (child === null) {\n    appendChildToNode(document.createComment(\"\"), node);\n  } else if (isElement(child)) {\n    appendChildToNode(child, node);\n  } else if (isShadowRoot(child)) {\n    const shadowRoot = node.attachShadow(child.attr);\n    appendChild(child.children, shadowRoot);\n    attachRef(child.ref, shadowRoot);\n  }\n}\nfunction appendChildren(children, node) {\n  for (const child of [...children]) {\n    appendChild(child, node);\n  }\n  return node;\n}\nfunction appendChildToNode(child, node) {\n  if (node instanceof window.HTMLTemplateElement) {\n    node.content.appendChild(child);\n  } else {\n    node.appendChild(child);\n  }\n}\nfunction normalizeAttribute(s, separator) {\n  return s.replace(/[A-Z]/g, (match) => separator + match.toLowerCase());\n}\nfunction style(node, value) {\n  if (value == null || value === false);\n  else if (Array.isArray(value)) {\n    value.forEach((v) => style(node, v));\n  } else if (isString(value)) {\n    node.setAttribute(\"style\", value);\n  } else if (isObject(value)) {\n    forEach(value, (val, key) => {\n      if (key.indexOf(\"-\") === 0) {\n        // CSS custom properties (variables) start with `-` (e.g. `--my-variable`)\n        // and must be assigned via `setProperty`.\n        node.style.setProperty(key, val);\n      } else if (isNumber(val) && isUnitlessNumber[key] !== 0) {\n        node.style[key] = val + \"px\";\n      } else {\n        node.style[key] = val;\n      }\n    });\n  }\n}\nfunction attribute(key, value, node) {\n  switch (key) {\n    case \"xlinkActuate\":\n    case \"xlinkArcrole\":\n    case \"xlinkHref\":\n    case \"xlinkRole\":\n    case \"xlinkShow\":\n    case \"xlinkTitle\":\n    case \"xlinkType\":\n      attrNS(node, XLinkNamespace, normalizeAttribute(key, \":\"), value);\n      return;\n    case \"xmlnsXlink\":\n      attr(node, normalizeAttribute(key, \":\"), value);\n      return;\n    case \"xmlBase\":\n    case \"xmlLang\":\n    case \"xmlSpace\":\n      attrNS(node, XMLNamespace, normalizeAttribute(key, \":\"), value);\n      return;\n  }\n  switch (key) {\n    case \"htmlFor\":\n      attr(node, \"for\", value);\n      return;\n    case \"dataset\":\n      forEach(value, (dataValue, dataKey) => {\n        if (dataValue != null) {\n          node.dataset[dataKey] = dataValue;\n        }\n      });\n      return;\n    case \"innerHTML\":\n    case \"innerText\":\n    case \"textContent\":\n      if (isVisibleChild(value)) {\n        node[key] = value;\n      }\n      return;\n    case \"dangerouslySetInnerHTML\":\n      if (isObject(value)) {\n        node.innerHTML = value[\"__html\"];\n      }\n      return;\n    case \"value\":\n      if (value == null || node instanceof window.HTMLSelectElement) {\n        // skip nullish values\n        // for `<select>` apply value after appending `<option>` elements\n        return;\n      } else if (node instanceof window.HTMLTextAreaElement) {\n        node.value = value;\n        return;\n      }\n      // use attribute for other elements\n      break;\n    case \"spellCheck\":\n      node.spellcheck = value;\n      return;\n    case \"class\":\n    case \"className\":\n      if (isFunction(value)) {\n        value(node);\n      } else {\n        attr(node, \"class\", className(value));\n      }\n      return;\n    case \"ref\":\n    case \"namespaceURI\":\n      return;\n    case \"style\":\n      style(node, value);\n      return;\n    case \"on\":\n    case \"onCapture\":\n      forEach(value, (eventHandler, eventName) => {\n        node.addEventListener(eventName, eventHandler, key === \"onCapture\");\n      });\n      return;\n    // fallthrough\n  }\n  if (isFunction(value)) {\n    if (key[0] === \"o\" && key[1] === \"n\") {\n      let attribute = key.toLowerCase();\n      const useCapture = attribute.endsWith(\"capture\");\n      if (attribute === \"ondoubleclick\") {\n        attribute = \"ondblclick\";\n      } else if (useCapture && attribute === \"ondoubleclickcapture\") {\n        attribute = \"ondblclickcapture\";\n      }\n      if (!useCapture && node[attribute] === null) {\n        // use property when possible PR #17\n        node[attribute] = value;\n      } else if (useCapture) {\n        node.addEventListener(\n          attribute.substring(2, attribute.length - 7),\n          value,\n          true,\n        );\n      } else {\n        let eventName;\n        if (attribute in window) {\n          // standard event\n          // the JSX attribute could have been \"onMouseOver\" and the\n          // member name \"onmouseover\" is on the window's prototype\n          // so let's add the listener \"mouseover\", which is all lowercased\n          const standardEventName = attribute.substring(2);\n          eventName = standardEventName;\n        } else {\n          // custom event\n          // the JSX attribute could have been \"onMyCustomEvent\"\n          // so let's trim off the \"on\" prefix and lowercase the first character\n          // and add the listener \"myCustomEvent\"\n          // except for the first character, we keep the event name case\n          const customEventName = attribute[2] + key.slice(3);\n          eventName = customEventName;\n        }\n        node.addEventListener(eventName, value);\n      }\n    }\n  } else if (isObject(value)) {\n    node[key] = value;\n  } else if (value === true) {\n    attr(node, key, \"\");\n  } else if (value !== false && value != null) {\n    if (node instanceof SVGElement && !nonPresentationSVGAttributes.test(key)) {\n      attr(node, normalizeAttribute(key, \"-\"), value);\n    } else {\n      attr(node, key, value);\n    }\n  }\n}\nfunction attr(node, key, value) {\n  node.setAttribute(key, value);\n}\nfunction attrNS(node, namespace, key, value) {\n  node.setAttributeNS(namespace, key, value);\n}\nfunction attributes(attr, node) {\n  for (const key of keys(attr)) {\n    attribute(key, attr[key], node);\n  }\n  return node;\n}\n\nfunction useText(initialValue) {\n  const text = new Text();\n  Object.defineProperty(text, \"toString\", {\n    value() {\n      return this.textContent;\n    },\n  });\n  function setText(value) {\n    text.textContent = value;\n  }\n  if (initialValue != null) {\n    setText(initialValue);\n  }\n  return [text, setText];\n}\nfunction useClassList(initialValue) {\n  const div = document.createElement(\"div\");\n  if (initialValue != null) {\n    div.className = className(initialValue);\n  }\n  let list = div.classList;\n  function ClassList(value) {\n    value.setAttribute(\"class\", list.value);\n    list = value.classList;\n  }\n  Object.defineProperties(\n    ClassList,\n    Object.getOwnPropertyDescriptors({\n      get size() {\n        return list.length;\n      },\n      get value() {\n        return list.value;\n      },\n      add() {\n        list.add(...arguments);\n      },\n      remove() {\n        list.remove(...arguments);\n      },\n      toggle(token, force) {\n        list.toggle(token, force);\n      },\n      contains(token) {\n        return list.contains(token);\n      },\n    }),\n  );\n  return ClassList;\n}\n\nfunction useMemo(factory) {\n  return factory();\n}\nfunction forwardRef(render) {\n  return (_ref) => {\n    let { ref, ...props } = _ref;\n    return render(props, ref ?? createRef());\n  };\n}\nfunction useImperativeHandle(ref, init) {\n  attachRef(ref, init());\n}\n\nconst cache = /* @__PURE__ */ new Map();\nconst createStyledComponent = (name) =>\n  function (list) {\n    for (\n      var _len = arguments.length,\n        interpolations = new Array(_len > 1 ? _len - 1 : 0),\n        _key = 1;\n      _key < _len;\n      _key++\n    ) {\n      interpolations[_key - 1] = arguments[_key];\n    }\n    return (_ref) => {\n      let { style, ...props } = _ref;\n      const lastIndex = list.length - 1;\n      const css =\n        list.slice(0, lastIndex).reduce((p, s, i) => {\n          const interpolation = interpolations[i];\n          const current =\n            typeof interpolation === \"function\"\n              ? interpolation(props)\n              : interpolation;\n          return p + s + current;\n        }, \"\") + list[lastIndex];\n      return createElement(name, {\n        style: [css, style],\n        ...props,\n      });\n    };\n  };\nconst baseStyled = (customComponent) => createStyledComponent(customComponent);\nconst styled = /* @__PURE__ */ new Proxy(baseStyled, {\n  get(_, name) {\n    return setIfAbsent(cache, name, () => createStyledComponent(name));\n  },\n});\nfunction setIfAbsent(map, key, getValue) {\n  if (map.has(key)) {\n    return map.get(key);\n  } else {\n    const value = getValue(key);\n    map.set(key, value);\n    return value;\n  }\n}\n\nvar index = {\n  Component,\n  PureComponent: Component,\n  createElement,\n  Fragment,\n  ShadowRoot,\n};\nfunction preventDefault(event) {\n  event.preventDefault();\n  return event;\n}\nfunction stopPropagation(event) {\n  event.stopPropagation();\n  return event;\n}\n\nexport {\n  Component,\n  Fragment,\n  Component as PureComponent,\n  SVGNamespace,\n  ShadowRoot,\n  Fragment as StrictMode,\n  className,\n  createElement,\n  createFactory,\n  createRef,\n  index as default,\n  forwardRef,\n  createElement as h,\n  isRef,\n  jsx,\n  jsx as jsxs,\n  identity as memo,\n  preventDefault,\n  stopPropagation,\n  styled,\n  identity as useCallback,\n  useClassList,\n  useImperativeHandle,\n  useMemo,\n  createRef as useRef,\n  useText,\n};\n","export const promiseWithResolvers = <T extends unknown = any>() => {\n  let resolve!: (value: T | PromiseLike<T>) => void\n  let reject!: (reason?: any) => void\n  const promise = new Promise<T>((res, rej) => {\n    resolve = res\n    reject = rej\n  })\n  return { promise, resolve, reject }\n}\n\nif (!Promise.withResolvers) {\n  Promise.withResolvers = promiseWithResolvers\n}\n","import type { Inject, InPageEdit, Schema } from '@inpageedit/core'\nimport { promiseWithResolvers } from './Promise.withResolvers'\n\nexport interface IPEPlugin {\n  name: string\n  inject?: Inject\n  apply: (ctx: InPageEdit) => Promise<void> | void\n  [k: string]: any\n}\n\nexport const defineIPEPlugin = (plugin: IPEPlugin): IPEPlugin => {\n  return plugin\n}\n\nexport class BasePlugin<K extends unknown = any> {\n  public name: string\n  public config: K\n  /** 依赖注入 */\n  static inject?: Inject = []\n  /** 可重用？ */\n  static reusable = false\n  /** 插件的偏好设置模式 */\n  static PreferencesSchema?: Schema\n\n  constructor(\n    public ctx: InPageEdit,\n    config: K = undefined as unknown as K,\n    name?: string\n  ) {\n    this.name = name || ''\n    this.config = config || ({} as K)\n    const { promise, resolve, reject } = promiseWithResolvers<void>()\n    queueMicrotask(() => {\n      if (!this.name) {\n        this.name = this.constructor.name\n      }\n      try {\n        const ret = this.start()\n        if (ret && typeof (ret as Promise<unknown>).then === 'function') {\n          ;(ret as Promise<unknown>)\n            .then(() => resolve())\n            .catch((err) => {\n              this.logger.error('start() returns a rejected promise', err)\n              reject(err)\n            })\n        } else {\n          resolve()\n        }\n      } catch (err) {\n        this.logger.error('start() threw synchronously', err)\n        reject(err)\n      }\n\n      promise.then(() => {\n        this.logger.debug('started')\n      })\n      promise.catch((e) => {\n        this.logger.error('start failed', e)\n        this.ctx.scope.dispose()\n      })\n    })\n    this.ctx.once('dispose', () => {\n      this.stop()\n      this.logger.debug('disposed')\n    })\n  }\n\n  protected start(): Promise<void> | void {}\n  protected stop(): Promise<void> | void {}\n\n  get logger() {\n    return this.ctx.logger(this.name)\n  }\n  get Schema() {\n    return this.ctx.schema\n  }\n}\n","import './style.scss'\nimport { defineIPEPlugin } from '~~/defineIPEPlugin.js'\nimport type { IWikiTitle } from '@inpageedit/core'\n\n// JSX Components\nconst EditButton = ({\n  isRedLink,\n  onClick,\n}: {\n  isRedLink: boolean\n  onClick: (e: MouseEvent) => void\n}) =>\n  (\n    <a\n      href=\"#ipe://quick-edit/\"\n      class={`ipe-quick-edit ${isRedLink ? 'ipe-quick-edit--create-only' : ''}`}\n      style=\"user-select: none; margin-left: 0.2em;\"\n      onClick={onClick}\n    >\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n        class=\"icon icon-tabler icons-tabler-outline icon-tabler-pencil-bolt ipe-icon\"\n      >\n        <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\n        <path d=\"M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4\" />\n        <path d=\"M13.5 6.5l4 4\" />\n        <path d=\"M19 16l-2 3h4l-2 3\" />\n      </svg>\n    </a>\n  ) as HTMLAnchorElement\n\nconst CounterpartLinks = ({\n  counterpartTitle,\n  isMissing,\n  onCounterpartEditClick,\n}: {\n  counterpartTitle: IWikiTitle\n  isMissing: boolean\n  onCounterpartEditClick: (e: MouseEvent) => void\n}) => {\n  const isCounterpartSubject = counterpartTitle.equals(counterpartTitle.getSubjectPage())\n  const counterpartText = isCounterpartSubject ? 'Main' : 'Talk'\n  const counterpartPrefixed = counterpartTitle.getPrefixedText()\n\n  let href = counterpartTitle.getURL().toString()\n  if (isMissing) {\n    const url = new URL(href, window.location.origin)\n    url.searchParams.set('action', 'edit')\n    url.searchParams.set('redlink', '1')\n    href = url.pathname + url.search\n  }\n\n  return (\n    <span class=\"ipe-in-cat-edit-counterpart\">\n      {' ('}\n      <a href={href} title={counterpartPrefixed} class={isMissing ? 'new' : ''}>\n        {counterpartText}\n      </a>\n      <EditButton isRedLink={isMissing} onClick={onCounterpartEditClick} />\n      {')'}\n    </span>\n  ) as HTMLSpanElement\n}\n\ntype AnchorModel = {\n  $el: HTMLAnchorElement\n  titlePrefixed: string\n  counterpart?: {\n    title: IWikiTitle\n    prefixed: string\n  }\n}\n\nexport default defineIPEPlugin({\n  name: 'in-cat-edit',\n  inject: ['quickEdit', 'inArticleLinks', 'api', 'wiki'],\n  apply: (ctx) => {\n    // Only run in Category namespace\n    const ns = ctx.wiki.mwConfig.get('wgNamespaceNumber')\n    if (ns !== 14) return\n\n    mw.hook('wikipage.content').add(async ($content: any) => {\n      const content = $content[0]\n      if (!content) return\n\n      const allContainers = Array.from(\n        content.querySelectorAll(\n          '.mw-category, #mw-subcategories, #mw-pages, #mw-category-media'\n        )\n      ) as HTMLElement[]\n\n      // Filter out containers that are inside other containers to avoid double processing\n      const uniqueContainers = allContainers.filter((container, _, self) => {\n        return !self.some((other) => other !== container && other.contains(container))\n      })\n\n      if (!uniqueContainers.length) return\n\n      const anchors: any[] = []\n      uniqueContainers.forEach((container) => {\n        anchors.push(...ctx.inArticleLinks.scanAnchors(container))\n      })\n\n      const models: AnchorModel[] = []\n      const titlesToCheck: string[] = []\n\n      // Build models\n      for (const { $el, title } of anchors) {\n        if (!title) continue\n\n        const titlePrefixed = title.getPrefixedText()\n        const counterpartTitle = getCounterpartTitle(title)\n\n        const model: AnchorModel = { $el, titlePrefixed }\n\n        if (counterpartTitle) {\n          const counterpartPrefixed = counterpartTitle.getPrefixedText()\n          model.counterpart = {\n            title: counterpartTitle,\n            prefixed: counterpartPrefixed,\n          }\n          titlesToCheck.push(counterpartPrefixed)\n        }\n\n        models.push(model)\n      }\n\n      const missingTitles = await getMissingTitles(titlesToCheck, ctx.api)\n\n      // Render\n      for (const { $el, titlePrefixed, counterpart } of models) {\n        if ($el.dataset.ipeInCatEditProcessed) continue\n        $el.dataset.ipeInCatEditProcessed = '1'\n\n        const fragment = document.createDocumentFragment()\n\n        // 1. Edit button for current page\n        fragment.appendChild(\n          <EditButton\n            isRedLink={false}\n            onClick={(e) => {\n              e.preventDefault()\n              ctx.quickEdit.showModal({\n                title: titlePrefixed,\n                createOnly: false,\n              })\n            }}\n          />\n        )\n\n        // 2. Counterpart link and its edit button\n        if (counterpart) {\n          const { title: counterpartTitle, prefixed: counterpartPrefixed } = counterpart\n          const isMissing = missingTitles.has(counterpartPrefixed)\n\n          fragment.appendChild(\n            <CounterpartLinks\n              counterpartTitle={counterpartTitle}\n              isMissing={isMissing}\n              onCounterpartEditClick={(e) => {\n                e.preventDefault()\n                ctx.quickEdit.showModal({\n                  title: counterpartPrefixed,\n                  createOnly: isMissing,\n                })\n              }}\n            />\n          )\n        }\n\n        const parent = $el.parentNode\n        if (parent) {\n          parent.insertBefore(fragment, $el.nextSibling)\n        }\n      }\n    })\n  },\n})\n\nconst getCounterpartTitle = (title: IWikiTitle): IWikiTitle | null => {\n  const subject = title.getSubjectPage()\n  if (title.equals(subject)) {\n    return title.getTalkPage()\n  }\n  return subject\n}\n\nconst getMissingTitles = async (\n  titles: string[],\n  api: any,\n  chunkSize = 50\n): Promise<Set<string>> => {\n  const missing = new Set<string>()\n  const requests: Promise<void>[] = []\n\n  for (let i = 0; i < titles.length; i += chunkSize) {\n    const chunk = titles.slice(i, i + chunkSize)\n\n    requests.push(\n      api\n        .post({\n          action: 'query',\n          titles: chunk.join('|'),\n          format: 'json',\n          formatversion: 2,\n        })\n        .then((response: any) => {\n          const query = response.data?.query || response.query\n          query?.pages?.forEach((page: any) => {\n            if (page.missing) {\n              missing.add(page.title)\n            }\n          })\n        })\n        .catch((e: unknown) => {\n          console.error('[in-cat-edit] Failed to check page existence', e)\n        })\n    )\n  }\n\n  await Promise.all(requests)\n  return missing\n}\n"],"names":["keys","isBoolean","val","isElement","isString","isNumber","isObject","isFunction","isComponentClass","Component","isArrayLike","obj","forEach","value","fn","key","isRef","maybeRef","isUnitlessNumber","prefixKey","prefix","prefixes","prop","jsxDomType","JsxDomType","isShadowRoot","el","SVGNamespace","XLinkNamespace","XMLNamespace","isVisibleChild","className","k","svg","nonPresentationSVGAttributes","initComponentClass","Class","attr","children","instance","node","attachRef","jsx","tag","_ref","attributes","appendChild","values","option","ref","child","appendChildren","appendChildToNode","shadowRoot","normalizeAttribute","s","separator","match","style","v","attribute","attrNS","dataValue","dataKey","eventHandler","eventName","useCapture","namespace","promiseWithResolvers","resolve","reject","res","rej","defineIPEPlugin","plugin","EditButton","isRedLink","onClick","jsxs","CounterpartLinks","counterpartTitle","isMissing","onCounterpartEditClick","counterpartText","counterpartPrefixed","href","url","index","ctx","$content","content","uniqueContainers","container","_","self","other","anchors","models","titlesToCheck","$el","title","titlePrefixed","getCounterpartTitle","model","missingTitles","getMissingTitles","counterpart","fragment","e","parent","subject","titles","api","chunkSize","missing","requests","i","chunk","response","page"],"mappings":"AACA,MAAMA,IAAO,OAAO;AAIpB,SAASC,EAAUC,GAAK;AACtB,SAAO,OAAOA,KAAQ;AACxB;AACA,SAASC,EAAUD,GAAK;AACtB,SAAOA,KAAO,OAAOA,EAAI,YAAa;AACxC;AACA,SAASE,EAASF,GAAK;AACrB,SAAO,OAAOA,KAAQ;AACxB;AACA,SAASG,EAASH,GAAK;AACrB,SAAO,OAAOA,KAAQ;AACxB;AACA,SAASI,EAASJ,GAAK;AACrB,SAAO,OAAOA,KAAQ,WAAWA,MAAQ,OAAOK,EAAWL,CAAG;AAChE;AACA,SAASK,EAAWL,GAAK;AACvB,SAAO,OAAOA,KAAQ;AACxB;AACA,SAASM,EAAiBC,GAAW;AACnC,SAAO,CAAC,EAAEA,KAAaA,EAAU;AACnC;AACA,SAASC,EAAYC,GAAK;AACxB,SACEL,EAASK,CAAG,KACZ,OAAOA,EAAI,UAAW,YACtB,OAAOA,EAAI,YAAa;AAE5B;AACA,SAASC,EAAQC,GAAOC,GAAI;AAC1B,MAAKD;AACL,eAAWE,KAAOf,EAAKa,CAAK;AAC1B,MAAAC,EAAGD,EAAME,CAAG,GAAGA,CAAG;AAEtB;AAOA,SAASC,EAAMC,GAAU;AACvB,SAAOX,EAASW,CAAQ,KAAK,aAAaA;AAC5C;AAYA,MAAMC,IAAmB;AAAA,EACvB,yBAAyB;AAAA,EACzB,mBAAmB;AAAA,EACnB,kBAAkB;AAAA,EAClB,kBAAkB;AAAA,EAClB,SAAS;AAAA,EACT,cAAc;AAAA,EACd,iBAAiB;AAAA,EACjB,aAAa;AAAA,EACb,SAAS;AAAA,EACT,MAAM;AAAA,EACN,UAAU;AAAA,EACV,cAAc;AAAA,EACd,YAAY;AAAA,EACZ,cAAc;AAAA,EACd,WAAW;AAAA,EACX,UAAU;AAAA,EACV,SAAS;AAAA,EACT,YAAY;AAAA,EACZ,aAAa;AAAA,EACb,cAAc;AAAA,EACd,YAAY;AAAA,EACZ,eAAe;AAAA,EACf,gBAAgB;AAAA,EAChB,iBAAiB;AAAA,EACjB,YAAY;AAAA,EACZ,WAAW;AAAA,EACX,YAAY;AAAA,EACZ,SAAS;AAAA,EACT,OAAO;AAAA,EACP,SAAS;AAAA,EACT,SAAS;AAAA,EACT,QAAQ;AAAA,EACR,QAAQ;AAAA,EACR,MAAM;AAAA;AAAA,EAEN,aAAa;AAAA,EACb,cAAc;AAAA,EACd,aAAa;AAAA,EACb,iBAAiB;AAAA,EACjB,kBAAkB;AAAA,EAClB,kBAAkB;AAAA,EAClB,eAAe;AAAA,EACf,aAAa;AACf;AAQA,SAASC,EAAUC,GAAQL,GAAK;AAC9B,SAAOK,IAASL,EAAI,OAAO,CAAC,EAAE,gBAAgBA,EAAI,UAAU,CAAC;AAC/D;AAMA,MAAMM,IAAW,CAAC,UAAU,MAAM,OAAO,GAAG;AAG5CrB,EAAKkB,CAAgB,EAAE,QAAQ,CAACI,MAAS;AACvC,EAAAD,EAAS,QAAQ,CAACD,MAAW;AAC3B,IAAAF,EAAiBC,EAAUC,GAAQE,CAAI,CAAC,IAAI;AAAA,EAC9C,CAAC;AACH,CAAC;AAED,MAAMC,IAAa,uBAAO,IAAI,cAAc;AAC5C,IAAIC,IAA4B,0BAAUA,GAAY;AACpD,SAAAA,EAAW,aAAgB,cACpBA;AACT,GAAGA,KAAc,CAAA,CAAE;AAUnB,SAASC,EAAaC,GAAI;AACxB,SAAOA,KAAM,QAAQA,EAAGH,CAAU,MAAMC,EAAW;AACrD;AAEA,MAAMG,IAAe,8BACfC,IAAiB,gCACjBC,IAAe;AAIrB,SAASC,EAAejB,GAAO;AAC7B,SAAO,CAACZ,EAAUY,CAAK,KAAKA,KAAS;AACvC;AAMA,SAASkB,EAAUlB,GAAO;AACxB,SAAI,MAAM,QAAQA,CAAK,IACdA,EAAM,IAAIkB,CAAS,EAAE,OAAO,OAAO,EAAE,KAAK,GAAG,IAC3CzB,EAASO,CAAK,IACnB,OAAO,YAAYA,IACdkB,EAAU,MAAM,KAAKlB,CAAK,CAAC,IAE7Bb,EAAKa,CAAK,EACd,OAAO,CAACmB,MAAMnB,EAAMmB,CAAC,CAAC,EACtB,KAAK,GAAG,IACFF,EAAejB,CAAK,IACtB,KAAKA,IAEL;AAEX;AACA,MAAMoB,IAAM;AAAA,EACV,SAAS;AAAA,EACT,QAAQ;AAAA,EACR,UAAU;AAAA,EACV,MAAM;AAAA,EACN,MAAM;AAAA,EACN,SAAS;AAAA,EACT,SAAS;AAAA,EACT,eAAe;AAAA,EACf,qBAAqB;AAAA,EACrB,aAAa;AAAA,EACb,kBAAkB;AAAA,EAClB,mBAAmB;AAAA,EACnB,mBAAmB;AAAA,EACnB,gBAAgB;AAAA,EAChB,SAAS;AAAA,EACT,SAAS;AAAA,EACT,SAAS;AAAA,EACT,SAAS;AAAA,EACT,SAAS;AAAA,EACT,gBAAgB;AAAA,EAChB,SAAS;AAAA,EACT,SAAS;AAAA,EACT,aAAa;AAAA,EACb,cAAc;AAAA,EACd,UAAU;AAAA,EACV,cAAc;AAAA,EACd,oBAAoB;AAAA,EACpB,aAAa;AAAA,EACb,QAAQ;AAAA,EACR,cAAc;AAAA,EACd,QAAQ;AAAA,EACR,eAAe;AAAA,EACf,GAAG;AAAA,EACH,OAAO;AAAA,EACP,MAAM;AAAA,EACN,gBAAgB;AAAA,EAChB,QAAQ;AAAA,EACR,MAAM;AAAA,EACN,UAAU;AAAA,EACV,MAAM;AAAA,EACN,SAAS;AAAA,EACT,SAAS;AAAA,EACT,UAAU;AAAA,EACV,gBAAgB;AAAA,EAChB,MAAM;AAAA,EACN,MAAM;AAAA,EACN,KAAK;AAAA,EACL,QAAQ;AAAA,EACR,QAAQ;AAAA,EACR,MAAM;AAAA,EACN,UAAU;AAAA,EACV,OAAO;AAAA,EACP,KAAK;AAAA,EACL,MAAM;AACR,GACMC,IACJ;AAkBF,SAASC,EAAmBC,GAAOC,GAAMC,GAAU;AACjD,EAAAD,IAAO;AAAA,IACL,GAAGA;AAAA,IACH,UAAAC;AAAA,EACJ;AACE,QAAMC,IAAW,IAAIH,EAAMC,CAAI,GACzBG,IAAOD,EAAS,OAAM;AAC5B,SAAI,SAASF,KACXI,EAAUJ,EAAK,KAAKE,CAAQ,GAEvBC;AACT;AAGA,SAASE,EAAIC,GAAKC,GAAM;AACtB,MAAI,EAAE,UAAAN,GAAU,GAAGD,EAAI,IAAKO;AAC5B,EAAI,CAACP,EAAK,gBAAgBJ,EAAIU,CAAG,MAAM,MACrCN,IAAO;AAAA,IACL,GAAGA;AAAA,IACH,cAAcV;AAAA,EACpB;AAEE,MAAIa;AACJ,MAAIpC,EAASuC,CAAG,GAAG;AAQjB,QAPAH,IAAOH,EAAK,eACR,SAAS,gBAAgBA,EAAK,cAAcM,CAAG,IAC/C,SAAS,cAAcA,CAAG,GAC9BE,GAAWR,GAAMG,CAAI,GACrBM,EAAYR,GAAUE,CAAI,GAGtBA,aAAgB,OAAO,qBAAqBH,EAAK,SAAS;AAC5D,UAAIA,EAAK,aAAa,MAAQ,MAAM,QAAQA,EAAK,KAAK,GAAG;AACvD,cAAMU,IAASV,EAAK,MAAM,IAAI,CAACxB,MAAU,OAAOA,CAAK,CAAC;AACtD,QAAA2B,EACG,iBAAiB,QAAQ,EACzB;AAAA,UACC,CAACQ,MAAYA,EAAO,WAAWD,EAAO,SAASC,EAAO,KAAK;AAAA,QACvE;AAAA,MACM;AACE,QAAAR,EAAK,QAAQH,EAAK;AAGtB,IAAAI,EAAUJ,EAAK,KAAKG,CAAI;AAAA,EAC1B,WAAWjC,EAAWoC,CAAG;AAEvB,IAAIrC,EAASqC,EAAI,YAAY,MAC3BN,IAAO;AAAA,MACL,GAAGM,EAAI;AAAA,MACP,GAAGN;AAAA,IACX,IAEIG,IAAOhC,EAAiBmC,CAAG,IACvBR,EAAmBQ,GAAKN,GAAMC,CAAQ,IACtCK,EAAI;AAAA,MACF,GAAGN;AAAA,MACH,UAAAC;AAAA,IACV,CAAS;AAAA;AAEL,UAAM,IAAI,UAAU,6BAA6BK,CAAG,EAAE;AAExD,SAAOH;AACT;AA4BA,SAASC,EAAUQ,GAAKT,GAAM;AAC5B,EAAIxB,EAAMiC,CAAG,IACXA,EAAI,UAAUT,IACLjC,EAAW0C,CAAG,KACvBA,EAAIT,CAAI;AAEZ;AACA,SAASM,EAAYI,GAAOV,GAAM;AAChC,MAAI9B,EAAYwC,CAAK;AACnB,IAAAC,EAAeD,GAAOV,CAAI;AAAA,WACjBpC,EAAS8C,CAAK,KAAK7C,EAAS6C,CAAK;AAC1C,IAAAE,EAAkB,SAAS,eAAeF,CAAK,GAAGV,CAAI;AAAA,WAC7CU,MAAU;AACnB,IAAAE,EAAkB,SAAS,cAAc,EAAE,GAAGZ,CAAI;AAAA,WACzCrC,EAAU+C,CAAK;AACxB,IAAAE,EAAkBF,GAAOV,CAAI;AAAA,WACpBf,EAAayB,CAAK,GAAG;AAC9B,UAAMG,IAAab,EAAK,aAAaU,EAAM,IAAI;AAC/C,IAAAJ,EAAYI,EAAM,UAAUG,CAAU,GACtCZ,EAAUS,EAAM,KAAKG,CAAU;AAAA,EACjC;AACF;AACA,SAASF,EAAeb,GAAUE,GAAM;AACtC,aAAWU,KAAS,CAAC,GAAGZ,CAAQ;AAC9B,IAAAQ,EAAYI,GAAOV,CAAI;AAEzB,SAAOA;AACT;AACA,SAASY,EAAkBF,GAAOV,GAAM;AACtC,EAAIA,aAAgB,OAAO,sBACzBA,EAAK,QAAQ,YAAYU,CAAK,IAE9BV,EAAK,YAAYU,CAAK;AAE1B;AACA,SAASI,EAAmBC,GAAGC,GAAW;AACxC,SAAOD,EAAE,QAAQ,UAAU,CAACE,MAAUD,IAAYC,EAAM,aAAa;AACvE;AACA,SAASC,EAAMlB,GAAM3B,GAAO;AAC1B,EAAIA,KAAS,QAAQA,MAAU,OACtB,MAAM,QAAQA,CAAK,IAC1BA,EAAM,QAAQ,CAAC8C,MAAMD,EAAMlB,GAAMmB,CAAC,CAAC,IAC1BvD,EAASS,CAAK,IACvB2B,EAAK,aAAa,SAAS3B,CAAK,IACvBP,EAASO,CAAK,KACvBD,EAAQC,GAAO,CAACX,GAAKa,MAAQ;AAC3B,IAAIA,EAAI,QAAQ,GAAG,MAAM,IAGvByB,EAAK,MAAM,YAAYzB,GAAKb,CAAG,IACtBG,EAASH,CAAG,KAAKgB,EAAiBH,CAAG,MAAM,IACpDyB,EAAK,MAAMzB,CAAG,IAAIb,IAAM,OAExBsC,EAAK,MAAMzB,CAAG,IAAIb;AAAA,EAEtB,CAAC;AAEL;AACA,SAAS0D,GAAU7C,GAAKF,GAAO2B,GAAM;AACnC,UAAQzB,GAAG;AAAA,IACT,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AACH,MAAA8C,EAAOrB,GAAMZ,GAAgB0B,EAAmBvC,GAAK,GAAG,GAAGF,CAAK;AAChE;AAAA,IACF,KAAK;AACH,MAAAwB,EAAKG,GAAMc,EAAmBvC,GAAK,GAAG,GAAGF,CAAK;AAC9C;AAAA,IACF,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AACH,MAAAgD,EAAOrB,GAAMX,GAAcyB,EAAmBvC,GAAK,GAAG,GAAGF,CAAK;AAC9D;AAAA,EACN;AACE,UAAQE,GAAG;AAAA,IACT,KAAK;AACH,MAAAsB,EAAKG,GAAM,OAAO3B,CAAK;AACvB;AAAA,IACF,KAAK;AACH,MAAAD,EAAQC,GAAO,CAACiD,GAAWC,MAAY;AACrC,QAAID,KAAa,SACftB,EAAK,QAAQuB,CAAO,IAAID;AAAA,MAE5B,CAAC;AACD;AAAA,IACF,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AACH,MAAIhC,EAAejB,CAAK,MACtB2B,EAAKzB,CAAG,IAAIF;AAEd;AAAA,IACF,KAAK;AACH,MAAIP,EAASO,CAAK,MAChB2B,EAAK,YAAY3B,EAAM;AAEzB;AAAA,IACF,KAAK;AACH,UAAIA,KAAS,QAAQ2B,aAAgB,OAAO;AAG1C;AACK,UAAIA,aAAgB,OAAO,qBAAqB;AACrD,QAAAA,EAAK,QAAQ3B;AACb;AAAA,MACF;AAEA;AAAA,IACF,KAAK;AACH,MAAA2B,EAAK,aAAa3B;AAClB;AAAA,IACF,KAAK;AAAA,IACL,KAAK;AACH,MAAIN,EAAWM,CAAK,IAClBA,EAAM2B,CAAI,IAEVH,EAAKG,GAAM,SAAST,EAAUlB,CAAK,CAAC;AAEtC;AAAA,IACF,KAAK;AAAA,IACL,KAAK;AACH;AAAA,IACF,KAAK;AACH,MAAA6C,EAAMlB,GAAM3B,CAAK;AACjB;AAAA,IACF,KAAK;AAAA,IACL,KAAK;AACH,MAAAD,EAAQC,GAAO,CAACmD,GAAcC,MAAc;AAC1C,QAAAzB,EAAK,iBAAiByB,GAAWD,GAAcjD,MAAQ,WAAW;AAAA,MACpE,CAAC;AACD;AAAA,EAEN;AACE,MAAIR,EAAWM,CAAK;AAClB,QAAIE,EAAI,CAAC,MAAM,OAAOA,EAAI,CAAC,MAAM,KAAK;AACpC,UAAI6C,IAAY7C,EAAI,YAAW;AAC/B,YAAMmD,IAAaN,EAAU,SAAS,SAAS;AAM/C,UALIA,MAAc,kBAChBA,IAAY,eACHM,KAAcN,MAAc,2BACrCA,IAAY,sBAEV,CAACM,KAAc1B,EAAKoB,CAAS,MAAM;AAErC,QAAApB,EAAKoB,CAAS,IAAI/C;AAAA,eACTqD;AACT,QAAA1B,EAAK;AAAA,UACHoB,EAAU,UAAU,GAAGA,EAAU,SAAS,CAAC;AAAA,UAC3C/C;AAAA,UACA;AAAA,QACV;AAAA,WACa;AACL,YAAIoD;AACJ,QAAIL,KAAa,SAMfK,IAD0BL,EAAU,UAAU,CAAC,IAS/CK,IADwBL,EAAU,CAAC,IAAI7C,EAAI,MAAM,CAAC,GAGpDyB,EAAK,iBAAiByB,GAAWpD,CAAK;AAAA,MACxC;AAAA,IACF;AAAA,QACK,CAAIP,EAASO,CAAK,IACvB2B,EAAKzB,CAAG,IAAIF,IACHA,MAAU,KACnBwB,EAAKG,GAAMzB,GAAK,EAAE,IACTF,MAAU,MAASA,KAAS,SACjC2B,aAAgB,cAAc,CAACN,EAA6B,KAAKnB,CAAG,IACtEsB,EAAKG,GAAMc,EAAmBvC,GAAK,GAAG,GAAGF,CAAK,IAE9CwB,EAAKG,GAAMzB,GAAKF,CAAK;AAG3B;AACA,SAASwB,EAAKG,GAAMzB,GAAKF,GAAO;AAC9B,EAAA2B,EAAK,aAAazB,GAAKF,CAAK;AAC9B;AACA,SAASgD,EAAOrB,GAAM2B,GAAWpD,GAAKF,GAAO;AAC3C,EAAA2B,EAAK,eAAe2B,GAAWpD,GAAKF,CAAK;AAC3C;AACA,SAASgC,GAAWR,GAAMG,GAAM;AAC9B,aAAWzB,KAAOf,EAAKqC,CAAI;AACzB,IAAAuB,GAAU7C,GAAKsB,EAAKtB,CAAG,GAAGyB,CAAI;AAEhC,SAAOA;AACT;AC5hBO,MAAM4B,KAAuB,MAA+B;AACjE,MAAIC,GACAC;AAKJ,SAAO,EAAE,SAJO,IAAI,QAAW,CAACC,GAAKC,MAAQ;AAC3C,IAAAH,IAAUE,GACVD,IAASE;AAAA,EACX,CAAC,GACiB,SAAAH,GAAS,QAAAC,EAAA;AAC7B;AAEK,QAAQ,kBACX,QAAQ,gBAAgBF;ACDnB,MAAMK,KAAkB,CAACC,MACvBA,GCNHC,IAAa,CAAC;AAAA,EAClB,WAAAC;AAAA,EACA,SAAAC;AACF,MAKI,gBAAAnC;AAAA,EAAC;AAAA,EAAA;AAAA,IACC,MAAK;AAAA,IACL,OAAO,kBAAkBkC,IAAY,gCAAgC,EAAE;AAAA,IACvE,OAAM;AAAA,IACN,SAAAC;AAAA,IAEA,UAAAC,gBAAAA;AAAAA,MAAC;AAAA,MAAA;AAAA,QACC,OAAM;AAAA,QACN,OAAM;AAAA,QACN,QAAO;AAAA,QACP,SAAQ;AAAA,QACR,MAAK;AAAA,QACL,QAAO;AAAA,QACP,gBAAa;AAAA,QACb,kBAAe;AAAA,QACf,mBAAgB;AAAA,QAChB,OAAM;AAAA,QAEN,UAAA;AAAA,UAAA,gBAAApC,EAAC,UAAK,QAAO,QAAO,GAAE,iBAAgB,MAAK,QAAO;AAAA,UAClD,gBAAAA,EAAC,QAAA,EAAK,GAAE,0DAAA,CAA0D;AAAA,UAClE,gBAAAA,EAAC,QAAA,EAAK,GAAE,gBAAA,CAAgB;AAAA,UACxB,gBAAAA,EAAC,QAAA,EAAK,GAAE,qBAAA,CAAqB;AAAA,QAAA;AAAA,MAAA;AAAA,IAAA;AAAA,EAC/B;AACF,GAGEqC,KAAmB,CAAC;AAAA,EACxB,kBAAAC;AAAA,EACA,WAAAC;AAAA,EACA,wBAAAC;AACF,MAIM;AAEJ,QAAMC,IADuBH,EAAiB,OAAOA,EAAiB,gBAAgB,IACvC,SAAS,QAClDI,IAAsBJ,EAAiB,gBAAA;AAE7C,MAAIK,IAAOL,EAAiB,OAAA,EAAS,SAAA;AACrC,MAAIC,GAAW;AACb,UAAMK,IAAM,IAAI,IAAID,GAAM,OAAO,SAAS,MAAM;AAChD,IAAAC,EAAI,aAAa,IAAI,UAAU,MAAM,GACrCA,EAAI,aAAa,IAAI,WAAW,GAAG,GACnCD,IAAOC,EAAI,WAAWA,EAAI;AAAA,EAC5B;AAEA,SACER,gBAAAA,EAAC,QAAA,EAAK,OAAM,+BACT,UAAA;AAAA,IAAA;AAAA,IACD,gBAAApC,EAAC,OAAE,MAAA2C,GAAY,OAAOD,GAAqB,OAAOH,IAAY,QAAQ,IACnE,UAAAE,EAAA,CACH;AAAA,IACA,gBAAAzC,EAACiC,GAAA,EAAW,WAAWM,GAAW,SAASC,GAAwB;AAAA,IAClE;AAAA,EAAA,GACH;AAEJ,GAWAK,KAAed,GAAgB;AAAA,EAC7B,MAAM;AAAA,EACN,QAAQ,CAAC,aAAa,kBAAkB,OAAO,MAAM;AAAA,EACrD,OAAO,CAACe,MAAQ;AAGd,IADWA,EAAI,KAAK,SAAS,IAAI,mBAAmB,MACzC,MAEX,GAAG,KAAK,kBAAkB,EAAE,IAAI,OAAOC,MAAkB;AACvD,YAAMC,IAAUD,EAAS,CAAC;AAC1B,UAAI,CAACC,EAAS;AASd,YAAMC,IAPgB,MAAM;AAAA,QAC1BD,EAAQ;AAAA,UACN;AAAA,QAAA;AAAA,MACF,EAIqC,OAAO,CAACE,GAAWC,GAAGC,MACpD,CAACA,EAAK,KAAK,CAACC,MAAUA,MAAUH,KAAaG,EAAM,SAASH,CAAS,CAAC,CAC9E;AAED,UAAI,CAACD,EAAiB,OAAQ;AAE9B,YAAMK,IAAiB,CAAA;AACvB,MAAAL,EAAiB,QAAQ,CAACC,MAAc;AACtC,QAAAI,EAAQ,KAAK,GAAGR,EAAI,eAAe,YAAYI,CAAS,CAAC;AAAA,MAC3D,CAAC;AAED,YAAMK,IAAwB,CAAA,GACxBC,IAA0B,CAAA;AAGhC,iBAAW,EAAE,KAAAC,GAAK,OAAAC,EAAA,KAAWJ,GAAS;AACpC,YAAI,CAACI,EAAO;AAEZ,cAAMC,IAAgBD,EAAM,gBAAA,GACtBpB,IAAmBsB,GAAoBF,CAAK,GAE5CG,IAAqB,EAAE,KAAAJ,GAAK,eAAAE,EAAA;AAElC,YAAIrB,GAAkB;AACpB,gBAAMI,IAAsBJ,EAAiB,gBAAA;AAC7C,UAAAuB,EAAM,cAAc;AAAA,YAClB,OAAOvB;AAAA,YACP,UAAUI;AAAA,UAAA,GAEZc,EAAc,KAAKd,CAAmB;AAAA,QACxC;AAEA,QAAAa,EAAO,KAAKM,CAAK;AAAA,MACnB;AAEA,YAAMC,IAAgB,MAAMC,GAAiBP,GAAeV,EAAI,GAAG;AAGnE,iBAAW,EAAE,KAAAW,GAAK,eAAAE,GAAe,aAAAK,EAAA,KAAiBT,GAAQ;AACxD,YAAIE,EAAI,QAAQ,sBAAuB;AACvC,QAAAA,EAAI,QAAQ,wBAAwB;AAEpC,cAAMQ,IAAW,SAAS,uBAAA;AAiB1B,YAdAA,EAAS;AAAA,UACP,gBAAAjE;AAAA,YAACiC;AAAA,YAAA;AAAA,cACC,WAAW;AAAA,cACX,SAAS,CAACiC,MAAM;AACd,gBAAAA,EAAE,eAAA,GACFpB,EAAI,UAAU,UAAU;AAAA,kBACtB,OAAOa;AAAA,kBACP,YAAY;AAAA,gBAAA,CACb;AAAA,cACH;AAAA,YAAA;AAAA,UAAA;AAAA,QACF,GAIEK,GAAa;AACf,gBAAM,EAAE,OAAO1B,GAAkB,UAAUI,MAAwBsB,GAC7DzB,IAAYuB,EAAc,IAAIpB,CAAmB;AAEvD,UAAAuB,EAAS;AAAA,YACP,gBAAAjE;AAAA,cAACqC;AAAA,cAAA;AAAA,gBACC,kBAAAC;AAAA,gBACA,WAAAC;AAAA,gBACA,wBAAwB,CAAC2B,MAAM;AAC7B,kBAAAA,EAAE,eAAA,GACFpB,EAAI,UAAU,UAAU;AAAA,oBACtB,OAAOJ;AAAA,oBACP,YAAYH;AAAA,kBAAA,CACb;AAAA,gBACH;AAAA,cAAA;AAAA,YAAA;AAAA,UACF;AAAA,QAEJ;AAEA,cAAM4B,IAASV,EAAI;AACnB,QAAIU,KACFA,EAAO,aAAaF,GAAUR,EAAI,WAAW;AAAA,MAEjD;AAAA,IACF,CAAC;AAAA,EACH;AACF,CAAC,GAEKG,KAAsB,CAACF,MAAyC;AACpE,QAAMU,IAAUV,EAAM,eAAA;AACtB,SAAIA,EAAM,OAAOU,CAAO,IACfV,EAAM,YAAA,IAERU;AACT,GAEML,KAAmB,OACvBM,GACAC,GACAC,IAAY,OACa;AACzB,QAAMC,wBAAc,IAAA,GACdC,IAA4B,CAAA;AAElC,WAASC,IAAI,GAAGA,IAAIL,EAAO,QAAQK,KAAKH,GAAW;AACjD,UAAMI,IAAQN,EAAO,MAAMK,GAAGA,IAAIH,CAAS;AAE3C,IAAAE,EAAS;AAAA,MACPH,EACG,KAAK;AAAA,QACJ,QAAQ;AAAA,QACR,QAAQK,EAAM,KAAK,GAAG;AAAA,QACtB,QAAQ;AAAA,QACR,eAAe;AAAA,MAAA,CAChB,EACA,KAAK,CAACC,MAAkB;AAEvB,SADcA,EAAS,MAAM,SAASA,EAAS,QACxC,OAAO,QAAQ,CAACC,MAAc;AACnC,UAAIA,EAAK,WACPL,EAAQ,IAAIK,EAAK,KAAK;AAAA,QAE1B,CAAC;AAAA,MACH,CAAC,EACA,MAAM,CAACX,MAAe;AACrB,gBAAQ,MAAM,gDAAgDA,CAAC;AAAA,MACjE,CAAC;AAAA,IAAA;AAAA,EAEP;AAEA,eAAM,QAAQ,IAAIO,CAAQ,GACnBD;AACT;","x_google_ignoreList":[0]}